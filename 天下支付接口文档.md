## 支付接口文档

## 1. 协议规则

传输方式：采用HTTP传输(生产环境建议HTTPS)

提交方式：采用POST/GET方式提交

字符编码：UTF-8

签名算法：MD5

### **1.1 参数规范**

交易金额：默认为人民币交易，单位为分，参数值不能带小数。

### **1.2 安全规范**

### 签名生成的通用步骤：

#### 第一步：

设所有发送或者接收到的数据为集合M，将集合M内非空参数值的参数按照参数名ASCII码从小到大排序（字典序），使用URL键值对的格式（即key1=value1&key2=value2…）拼接成字符串stringA。

特别注意以下重要规则：

◆ 参数名ASCII码从小到大排序（字典序）；

◆ 参数名区分大小写；

◆如果参数的值为空不参与签名；

◆ 验证调用返回或支付中心主动通知签名时，传送的sign参数不参与签名，将生成的签名与该sign值作校验。

◆ 支付中心接口可能增加字段，验证签名时必须支持增加的扩展字段

#### 第二步：

在stringA最后拼接上key得到stringSignTemp字符串，并对stringSignTemp进行MD5运算，再将得到的字符串所有字符转换为大写，得到sign值signValue。

待签名值：

money=2.0&outTradeNo=P12312321123&type=wechat&userId=test01&key=EWEFD123RGSRETYDFNGFGFGSHDFGH

签名结果：

5E0AA05DD4BB4FE5AB65608123EBA591

 

## 2. 创建订单（下单）

**接口描述**

业务通过统一下单接口可以发起任意三方支付渠道的支付订单。业务系统不必关心该如何调用三方支付，统一下单接口会根据业务系统选择的支付渠道ID，选择对应支付渠道的支付产品，发起下单请求，然后响应给业务系统支付请求所需参数。

**接口链接**

URL地址：http://ytxzf.kkc602.com/api/v2/pay/createOrder

**请求方式**

POST, JSON

#### **请求参数**

| ***字段名***        | ***变量名*** | ***必填*** | ***签名*** | ***类型***  | ***示例值***                              | ***描述***                        |
| ------------------- | ------------ | ---------- | ---------- | ----------- | ----------------------------------------- | --------------------------------- |
| 商户ID              | mchId        | 是         | 是         | String(11)  | 20001222                                  | 分配的商户号                      |
| 支付产品ID          | productId    | 是         | 是         | String      | 8000                                      | 支付产品ID                        |
| 商户订单号          | mchOrderNo   | 是         | 是         | String(30)  | 20160427210604000490                      | 商户生成的订单号                  |
| 支付金额            | amount       | 是         | 是         | int         | 100                                       | 支付金额,单位分                   |
| 支付结果前端跳转URL | returnUrl    | 否         | 是         | String(128) | http://shop.yeepay.org/return.htm         | 支付结果回调URL                   |
| 支付结果后台回调URL | notifyUrl    | 是         | 是         | String(128) | http://shop.yeepay.org/notify.htm         | 支付结果回调URL                   |
| 商品主题            | subject      | 是         | 是         | String(64)  | 测试商品1                                 | 商品主题                          |
| 商品描述信息        | body         | 是         | 是         | String(256) | 聚合测试商品描述                          | 商品描述信息                      |
| 扩展参数1           | param        | 否         | 是         | String(64)  |                                           | 支付中心回调时会原样返回          |
| 附加参数            | extra        | 否         | 否         | String(512) | {"openId":"o2RvowBf7sOVJf8kJksUEMceaDqo"} | 特定渠道发起时额外参数,见下面说明 |
| 签名                | sign         | 是         | 否         | String(32)  | C380BEC2BFD727A4B6845133519F3AD6          | 签名值，详见签名算法              |



#### 返回结果

| ***字段名*** | ***变量名*** | 必填 | ***类型***  | ***示例值*** | ***描述***                                     |
| ------------ | ------------ | ---- | ----------- | ------------ | ---------------------------------------------- |
| 返回状态码   | code         | 是   | Int         | 200          | 200为成功                                      |
| 返回信息     | msg          | 否   | String(128) | 签名失败     | 返回信息，为错误原因 签名失败 参数格式校验错误 |

```
{
    "code": 200, 
    "data": {
        "pay_url": "http://xmb.yuanshengfs.cn/api/pay/forward/aHR0cHM6Ly93eC50ZW5wYXkuY29tL2NnaS1iaW4vbW1wYXl3ZWItYmluL2NoZWNrbXdlYj9wcmVwYXlfaWQ9d3gxNzIzMzMyOTUyNjIyMDEwMTk3NGY0YTdhZmZhYjkwMDAwJnBhY2thZ2U9OTcxOTcxNTU0?do=eyJzaXRlX3VybCI6Imh0dHA6Ly93d3cueXVhbnNoZW5nZnMuY24vIiwic2VyaWFsX2ljcCI6Iuixq0lDUOWkhzIwMjIwMTc1MzXlj7ctMSJ9"
    }, 
    "msg": "操作成功"}
```



## 3 .查询支付订单

接口描述

业务系统通过查询支付订单接口获取最新的支付订单状态，并根据状态结果进一步处理业务逻辑。

接口链接

URL地址：http://ytxzf.kkc602.com/api/v1/pay/queryOrder

#### 请求参数

| ***字段名*** | ***变量名***  | ***必填*** | ***类型*** | ***示例值***                     | ***描述***                                                   |
| ------------ | ------------- | ---------- | ---------- | -------------------------------- | ------------------------------------------------------------ |
| 商户ID       | mchId         | 是         | String(30) | 1000000010                       | 支付中心分配的商户号                                         |
| 支付订单号   | payOrderId    | 是         | String(30) | P20160427210604000490            | 支付中心生成的订单号，与mchOrderNo二者传一即可               |
| 商户订单号   | mchOrderNo    | 是         | String(30) | 20160427210604000490             | 商户生成的订单号，与payOrderId二者传一即可                   |
| 是否执行回调 | executeNotify | 否         | Boolean    | true                             | 是否执行回调，如果为true，则支付中心会再次向商户发起一次回调，如果为false则不会发起 |
| 签名         | sign          | 是         | String(32) | C380BEC2BFD727A4B6845133519F3AD6 | 签名值，详见签名算法                                         |

#### 返回结果

| ***字段名*** | ***变量名*** | ***必填*** | ***类型***  | ***示例值*** | ***描述***                                             |
| ------------ | ------------ | ---------- | ----------- | ------------ | ------------------------------------------------------ |
| 返回状态码   | code         | 是         | Int         | 200          | 200为成功                                              |
| 返回信息     | msg          | 否         | String(128) | 签名失败     | 返回信息，如非空，为错误原因 签名失败 参数格式校验错误 |

以下字段在code为200的时候有返回

| ***字段名*** | ***变量名*** | ***必填*** | ***类型*** | ***示例值***          | ***描述***                                  |
| ------------ | ------------ | ---------- | ---------- | --------------------- | ------------------------------------------- |
| 商户ID       | mchId        | 是         | String(30) | 20001222              | 支付中心分配的商户号                        |
| 支付产品ID   | productId    | 是         | String     | 8001                  | 支付产品ID                                  |
| 支付订单号   | payOrderId   | 是         | String(30) | P20160427210604000490 | 支付中心生成的订单号                        |
| 商户订单号   | mchOrderNo   | 是         | String(30) | 20160427210604000490  | 商户生成的订单号                            |
| 支付金额     | amount       | 是         | int        | 100                   | 支付金额,单位分                             |
| 状态         | status       | 是         | int        | 1                     | 支付状态,1-支付中,2-支付成功,3-业务处理完成 |
| 支付成功时间 | paySuccTime  | 否         | Long       | 1505049094262         | 支付成功时间                                |

## ***4 支付结果通知***

请求方式

POST, JSON

#### ***通知参数***

| ***字段名*** | ***变量名*** | ***必填*** | ***签名*** | ***类型*** | ***示例值***                     | ***描述***                                  |
| ------------ | ------------ | ---------- | ---------- | ---------- | -------------------------------- | ------------------------------------------- |
| 支付订单号   | payOrderId   | 是         | 是         | String(30) | P20160427210604000490            | 支付中心生成的订单号                        |
| 商户ID       | mchId        | 是         | 是         | String(30) | 20001222                         | 支付中心分配的商户号                        |
| 支付产品ID   | productId    | 是         | 是         | String(20) | 8001                             | 支付产品ID                                  |
| 商户订单号   | mchOrderNo   | 是         | 是         | String(30) | 20160427210604000490             | 商户生成的订单号                            |
| 支付金额     | amount       | 是         | 是         | int        | 100                              | 支付金额,单位分                             |
| 状态         | status       | 是         | 是         | int        | 1                                | 支付状态,1-支付中,2-支付成功,3-业务处理完成 |
| 扩展参数     | param        | 否         | 是         | String(64) |                                  | 支付中心回调时会原样返回                    |
| 支付成功时间 | payTime      | 是         | 是         | Int64      |                                  | 精确到秒                                    |
| 签名         | sign         | 是         | 否         | String(32) | C380BEC2BFD727A4B6845133519F3AD6 | 签名值，详见签名算法                        |
| 币种         | currency     | 是         | 否         | String(6)  | CNY                              | 币种不参与签名                              |

#### ***返回结果***

业务系统处理后同步返回给支付中心，返回字符串 success 则表示成功，返回非success则表示处理失败，支付中心会再次通知业务系统。（通知频率为60/120/180/240/300,单位：秒）
